<ion-header [translucent]="true">
  <ion-toolbar class="nd-header">
    <ion-title class="nd-title">
      <div class="title-content">
        <ion-icon name="calculator" class="title-icon"></ion-icon>
        <span class="title-text">N.D Connect - Painel de Orçamentos</span>
      </div>
    </ion-title>
    <ion-buttons slot="end" class="header-actions">
      <ion-button
        *ngIf="podeAcessarTutorial"
        fill="clear"
        class="action-btn"
        (click)="navegarPara('/tutorial')"
        title="Tutorial do Sistema">
        <ion-icon name="school"></ion-icon>
      </ion-button>
      <ion-button fill="clear" class="action-btn" (click)="navegarPara('/admin/gestao-leads')">
        <ion-icon name="people"></ion-icon>
        <ion-badge *ngIf="notificacoes > 0" color="danger" class="notification-badge">
          {{ notificacoes }}
        </ion-badge>
      </ion-button>
      <ion-button fill="clear" class="action-btn" (click)="logout()">
        <ion-icon name="log-out"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="modern-content">
  <!-- Refresh -->
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <div class="skeleton-card" *ngFor="let item of [1,2,3]">
      <ion-skeleton-text animated style="width: 100%; height: 120px;"></ion-skeleton-text>
    </div>
  </div>

  <!-- Welcome Section -->
  <div class="welcome-section" *ngIf="!loading">
    <div class="welcome-card">
      <div class="welcome-content">
        <h1 class="welcome-title">Bem-vindo ao N.D Connect</h1>
        <p class="welcome-subtitle">Sistema de Gestão de Orçamentos e Leads</p>
        <ion-button class="welcome-btn" (click)="irParaOrcamentos()">
          <ion-icon name="calculator" slot="start"></ion-icon>
          Criar Novo Orçamento
        </ion-button>
      </div>
    </div>
  </div>

  <!-- Stats Overview -->
  <div class="stats-overview" *ngIf="!loading">
    <div class="stat-card">
      <div class="stat-icon">
        <ion-icon name="people"></ion-icon>
      </div>
      <div class="stat-info">
        <div class="stat-number">{{ stats.total }}</div>
        <div class="stat-label">Total de Leads</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">
        <ion-icon name="add-circle"></ion-icon>
      </div>
      <div class="stat-info">
        <div class="stat-number">{{ stats.novos }}</div>
        <div class="stat-label">Novos</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">
        <ion-icon name="trophy"></ion-icon>
      </div>
      <div class="stat-info">
        <div class="stat-number">{{ stats.convertidos }}</div>
        <div class="stat-label">Convertidos</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">
        <ion-icon name="call"></ion-icon>
      </div>
      <div class="stat-info">
        <div class="stat-number">{{ stats.contatados }}</div>
        <div class="stat-label">Contatados</div>
      </div>
    </div>
  </div>

  <!-- Main Actions Grid -->
  <div class="main-actions" *ngIf="!loading">
    <div class="action-card primary-action" (click)="irParaOrcamentos()">
      <div class="action-icon">
        <ion-icon name="calculator"></ion-icon>
      </div>
      <div class="action-content">
        <h3>Novo Orçamento</h3>
        <p>Criar orçamento para cliente</p>
      </div>
      <div class="action-arrow">
        <ion-icon name="arrow-forward"></ion-icon>
      </div>
    </div>

    <div class="action-card secondary-action" (click)="irParaGestaoLeads()">
      <div class="action-icon">
        <ion-icon name="people"></ion-icon>
      </div>
      <div class="action-content">
        <h3>Gestão de Leads</h3>
        <p>Gerenciar prospects</p>
        <ion-badge *ngIf="notificacoes > 0" color="danger" class="action-badge">
          {{ notificacoes }}
        </ion-badge>
      </div>
      <div class="action-arrow">
        <ion-icon name="arrow-forward"></ion-icon>
      </div>
    </div>

    <div class="action-card tertiary-action" (click)="irParaProdutos()">
      <div class="action-icon">
        <ion-icon name="cube"></ion-icon>
      </div>
      <div class="action-content">
        <h3>Produtos</h3>
        <p>Gerenciar catálogo</p>
      </div>
      <div class="action-arrow">
        <ion-icon name="arrow-forward"></ion-icon>
      </div>
    </div>

    <div class="action-card quaternary-action" (click)="irParaRelatorios()">
      <div class="action-icon">
        <ion-icon name="analytics"></ion-icon>
      </div>
      <div class="action-content">
        <h3>Relatórios</h3>
        <p>Análises e métricas</p>
      </div>
      <div class="action-arrow">
        <ion-icon name="arrow-forward"></ion-icon>
      </div>
    </div>
  </div>

  <!-- Recent Leads -->
  <div class="recent-leads" *ngIf="!loading">
    <div class="section-header">
      <h2 class="section-title">
        <ion-icon name="time"></ion-icon>
        Leads Recentes
        <ion-badge *ngIf="notificacoes > 0" color="primary" class="section-badge">
          {{ notificacoes }} {{ notificacoes === 1 ? 'novo' : 'novos' }}
        </ion-badge>
      </h2>
      <ion-button fill="clear" size="small" (click)="irParaGestaoLeads()" class="view-all-btn">
        <ion-icon name="eye" slot="start"></ion-icon>
        Ver Todos
      </ion-button>
    </div>

    <div class="leads-container" *ngIf="leadsRecentes.length > 0">
      <div *ngFor="let lead of leadsRecentes" class="lead-card" [class.lead-nao-lido]="!lead.lido && lead.status === 'novo'">
        <div class="lead-header">
          <div class="lead-status">
            <ion-icon [name]="getStatusIcon(lead.status)" [color]="getStatusColor(lead.status)"></ion-icon>
            <ion-chip [color]="getStatusColor(lead.status)" size="small">
              {{ lead.status | titlecase }}
            </ion-chip>
          </div>
          <ion-chip *ngIf="!lead.lido && lead.status === 'novo'" color="warning" size="small" class="novo-chip">
            <ion-icon name="add-circle" size="small"></ion-icon>
            Novo
          </ion-chip>
        </div>

        <div class="lead-info">
          <h3 class="lead-name">{{ lead.nome }}</h3>
          <p class="lead-email">{{ lead.email }}</p>
          <p class="lead-phone">{{ lead.telefone }}</p>
          <p class="lead-date">{{ formatarData(lead.created_at) }}</p>
        </div>

        <div class="lead-actions">
          <ion-button fill="clear" size="small" (click)="ligarPara(lead.telefone)" class="action-btn">
            <ion-icon name="call"></ion-icon>
          </ion-button>
          <ion-button fill="clear" size="small" (click)="enviarEmail(lead.email)" class="action-btn">
            <ion-icon name="mail"></ion-icon>
          </ion-button>
          <ion-button fill="clear" size="small" (click)="criarOrcamento(lead)" class="action-btn">
            <ion-icon name="document-text"></ion-icon>
          </ion-button>
          <ion-button fill="clear" size="small" (click)="verDetalhesLead(lead)" class="action-btn">
            <ion-icon name="eye"></ion-icon>
          </ion-button>
        </div>
      </div>
    </div>

    <div *ngIf="leadsRecentes.length === 0" class="empty-state">
      <ion-icon name="people-outline" size="large" color="medium"></ion-icon>
      <h3>Nenhum lead encontrado</h3>
      <p>Novos leads aparecerão aqui quando forem criados</p>
    </div>
  </div>

  <!-- Additional Tools -->
  <div class="additional-tools" *ngIf="!loading">
    <div class="tool-card" (click)="irParaHistoricoOrcamentos()">
      <div class="tool-icon">
        <ion-icon name="time"></ion-icon>
      </div>
      <div class="tool-content">
        <h3>Histórico</h3>
        <p>Orçamentos anteriores</p>
      </div>
    </div>

    <div class="tool-card" (click)="irParaGestaoOrcamentos()">
      <div class="tool-icon">
        <ion-icon name="settings"></ion-icon>
      </div>
      <div class="tool-content">
        <h3>Gestão</h3>
        <p>Status e aprovações</p>
      </div>
    </div>

    <div class="tool-card" (click)="irParaConfiguracoes()">
      <div class="tool-icon">
        <ion-icon name="cog"></ion-icon>
      </div>
      <div class="tool-content">
        <h3>Configurações</h3>
        <p>Sistema e preferências</p>
      </div>
    </div>
  </div>

</ion-content>
